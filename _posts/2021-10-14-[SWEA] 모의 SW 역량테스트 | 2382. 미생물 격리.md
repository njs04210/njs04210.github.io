---
## layout: post
## title:  [ëª¨ì˜ SW ì—­ëŸ‰í…ŒìŠ¤íŠ¸] 2382. ë¯¸ìƒë¬¼ ê²©ë¦¬
categories: [Algorithm]
comments: true
---

### [ðŸ‘‰ ë¬¸ì œ ë³´ëŸ¬ê°€ê¸°](https://swexpertacademy.com/main/code/problem/problemDetail.do?contestProbId=AV597vbqAH0DFAVl)  


#### Key Point 
ì´ì°¨ì› ë¦¬ìŠ¤íŠ¸ë¥¼ ì„ ì–¸í•´ì¤„ í•„ìš”ê°€ ì—†ëŠ” ë¬¸ì œì´ë‹¤.  
ë”•ì…”ë„ˆë¦¬ë¥¼ ì„ ì–¸(ch)í•˜ì—¬ íŠ¹ì • ì¢Œí‘œì˜ ìµœëŒ€ ë¯¸ìƒë¬¼ ê°’ì„ ê°€ì§„ êµ°ì§‘ì˜ ì •ë³´ë¥¼ ì €ìž¥í•œë‹¤.  

---


```python
dx, dy = [0,0,0,-1,1], [0,-1,1,0,0]
rev = [0,2,1,4,3]

T = int(input())
for test_case in range(1, T+1):
    N, M, K = map(int, input().split())
    a = [list(map(int, input().split())) for _ in range(K)] # ë¯¸ìƒë¬¼ ì •ë³´ ì €ìž¥

    for _ in range(M):
        ch = {} # íŠ¹ì • ì¢Œí‘œì˜ ë¯¸ìƒë¬¼ ìˆ˜ê°€ ê°€ìž¥ ë§Žì€ êµ°ì§‘ì˜ ì •ë³´ë¥¼ ì €ìž¥í•œë‹¤
        for idx in range(K):
            x, y, cnt, d = a[idx]

            if cnt == 0: continue # ì‚¬ë¼ì§„ êµ°ì§‘ì€ íŒ¨ìŠ¤

            # ì¢Œí‘œ ê°±ì‹ 
            nx = x + dy[d]
            ny = y + dx[d]
            a[idx][0], a[idx][1] = nx, ny

            # ì•½í’ˆì´ ì¹ í•´ì§„ ì…€ì— ë„ì°©í–ˆì„ ê²½ìš°
            if nx == 0 or nx == N-1 or ny == 0 or ny == N-1:
                cnt, d = cnt // 2, rev[d]
                a[idx][2] = cnt
                a[idx][3] = d

            # ì´ë™í•œ ì¢Œí‘œì˜ êµ°ì§‘ ì¡´ìž¬ ì—¬ë¶€
            if (nx, ny) not in ch:
                ch[(nx, ny)] = (idx, cnt)
            else:
                max_idx, max_cnt = ch[(nx, ny)]
                if cnt > max_cnt:
                    a[idx][2] += a[max_idx][2]
                    a[max_idx][2] = 0
                    ch[(nx, ny)] = (idx, cnt)
                else:
                    a[idx][2] = 0
                    a[max_idx][2] += cnt

    answer = sum(map(lambda x: x[2], a))
    print(f'#{test_case} {answer}')
```