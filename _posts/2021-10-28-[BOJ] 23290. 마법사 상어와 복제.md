---
## layout: post
## title:  [ë°±ì¤€] 23290. ë§ˆë²•ì‚¬ ìƒì–´ì™€ ë³µì œ
categories: [Algorithm]
comments: true
---

### [ğŸ‘‰ ë¬¸ì œ ë³´ëŸ¬ê°€ê¸°](https://www.acmicpc.net/problem/23290)  


#### Key Point
- Sì „ì ì˜¤í›„ 1ë²ˆ ë¬¸ì œì˜€ë‹¤.
- í˜„ì¥ì—ì„œ í’€ë©´ì„œ ë­ë„ê¹Œ. ë¬¸ì œ ì¡°ê±´ì„ ìš”ì•½í•˜ëŠ”ë° ì¢€ í˜ì´ ë“¤ì—ˆë‹¤. (í™•ì‹¤íˆ ë°±ì¤€ì´ ì˜ ì •ì œëœê±°êµ¬ë‚˜..)
- ë‚˜ëŠ” í˜„ì¥ì—ì„œ ë¬¼ê³ ê¸° ëƒ„ìƒˆ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ì„ ì‹¤ìˆ˜í–ˆë‹¤. (3ì´ ì•„ë‹Œ 2ë¡œ ë‘¬ì„œ)
- ë°±ì¤€ì€ í†µê³¼í–ˆì§€ë§Œ deepcopyì˜ ì¦ì€ ì‚¬ìš©ê³¼ 3ê°€ì§€ ì¢…ë¥˜ì˜ 2ì°¨ì› ë°°ì—´ì„ ì„ ì–¸í•´ ì‚¬ìš©í•´ í‘¼ ê²ƒì´.. ë¶ˆ-í¸
    - ì¡°ë§Œê°„ ë‹¤ë¥¸ ë¶„ë“¤ í’€ì´ë¥¼ ì°¸ê³ í•˜ì—¬ ë‹¤ì‹œ í’€ì–´ë³´ê² ë‹¤!

---

```python
from collections import deque
from copy import deepcopy


def dfs(L, x, y, r, total):
    if L == 3:
        global max_val, route, str_route
        if total < max_val: return

        if total > max_val:
            max_val = total
            route = deepcopy(r)
            str_route = ''.join(map(str, r))
        elif total == max_val:
            str_r = ''.join(map(str, r))
            if str_r < str_route:
                route = deepcopy(r)
                str_route = str_r
        return

    for i in range(4):
        nx = x + shark_dx[i]
        ny = y + shark_dy[i]
        if nx < 0 or nx >= 4 or ny < 0 or ny >= 4: continue
        r[L] = i
        tmp = MAP[nx][ny]
        MAP[nx][ny] = deque()
        dfs(L + 1, nx, ny, r, total + len(tmp))
        MAP[nx][ny] = deepcopy(tmp)


m, s = map(int, input().split())
MAP = [[deque() for _ in range(4)] for _ in range(4)]
smell_MAP = [[deque() for _ in range(4)] for _ in range(4)]
copyFish_MAP = [[deque() for _ in range(4)] for _ in range(4)]

fish_dx, fish_dy = [0, -1, -1, -1, 0, 1, 1, 1], [-1, -1, 0, 1, 1, 1, 0, -1]
shark_dx, shark_dy = [-1, 0, 1, 0], [0, -1, 0, 1]

for _ in range(m):
    x, y, d = map(int, input().split())
    MAP[x - 1][y - 1].append(d)

shark = list(map(int, input().split()))  # ìƒì–´ ìœ„ì¹˜
shark[0] -= 1
shark[1] -= 1

for _ in range(s):

    tmp_MAP = [[deque() for _ in range(4)] for _ in range(4)]

    # ë¬¼ê³ ê¸° ë³µì œ ë° ì´ë™í•˜ê¸°
    for i in range(4):
        for j in range(4):
            while MAP[i][j]:
                d = MAP[i][j].popleft()
                copyFish_MAP[i][j].append(d) 
                nx = i + fish_dx[d - 1]
                ny = j + fish_dy[d - 1]
                if (nx < 0 or nx >= 4 or ny < 0 or ny >= 4) or smell_MAP[nx][ny] or (nx == shark[0] and ny == shark[1]):
                    tmp_d = d
                    for _ in range(7):
                        nd = ((tmp_d - 1) - 1) % 8  # 45ë„ ë°˜ì‹œê³„ íšŒì „í•œ ë°©í–¥
                        nx = i + fish_dx[nd]
                        ny = j + fish_dy[nd]
                        if (nx < 0 or nx >= 4 or ny < 0 or ny >= 4) or smell_MAP[nx][ny] or (
                                nx == shark[0] and ny == shark[1]):
                            tmp_d = nd + 1
                            continue
                        else:
                            tmp_MAP[nx][ny].append(nd + 1)
                            break
                    else:
                        tmp_MAP[i][j].append(d)  # ì œìë¦¬ì— ë‘ê¸°
                else:
                    tmp_MAP[nx][ny].append(d)
    MAP = deepcopy(tmp_MAP)
    
    # ìƒì–´ì´ë™ ë£¨íŠ¸ ì •í•˜ê¸°
    max_val = -2147000000
    route, str_route = [-1, -1, -1], ""
    dfs(0, shark[0], shark[1], route, 0)

    for i in range(3):
        shark[0] += shark_dx[route[i]]
        shark[1] += shark_dy[route[i]]

        # ìƒì–´ê°€ ì •í•´ì§„ ë£¨íŠ¸ë¡œ ë¬¼ê³ ê¸° ì¡ì•„ë¨¹ê³  ëƒ„ìƒˆ ë‚¨ê¸°ê¸°
        while MAP[shark[0]][shark[1]]:
            MAP[shark[0]][shark[1]].popleft()
            smell_MAP[shark[0]][shark[1]].append(3) 

    for i in range(4):
        for j in range(4):

            # ë³µì œëœ ë¬¼ê³ ê¸° ì¹¸ì— ë‚˜íƒ€ë‚˜ê²Œ í•˜ê¸°
            while copyFish_MAP[i][j]:
                d = copyFish_MAP[i][j].popleft()
                MAP[i][j].append(d)

            # ë¬¼ê³ ê¸° ëƒ„ìƒˆ ì²˜ë¦¬í•˜ê¸°
            if not smell_MAP[i][j]: continue
            qlen = len(smell_MAP[i][j])
            for _ in range(qlen):
                time = smell_MAP[i][j].popleft()
                time -= 1
                if time != 0:
                    smell_MAP[i][j].append(time)

answer = 0
for i in range(4):
    for j in range(4):
        if not MAP[i][j]: continue
        answer += len(MAP[i][j])

print(answer)
```